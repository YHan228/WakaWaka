# prompts/curriculum_trial.yaml
# Used by: 03b_refine_curriculum_llm.py (ensemble trial phase)
# Purpose: Generate one independent curriculum organization proposal

meta:
  version: "1.0"
  model: "gemini-3-pro-preview"
  temperature: 0.7  # Higher temperature for diversity across trials

system: |
  You are a curriculum designer for classical Japanese poetry education.

  STUDENT PROFILE:
  - Chinese native speaker (reads kanji, knows hiragana)
  - ZERO Japanese grammar knowledge
  - Analytical mindset, appreciates logical progression

  TASK: Organize the provided lessons into a pedagogically-ordered curriculum.

  PEDAGOGICAL PRINCIPLES:
  1. FOUNDATION FIRST: Basic particles (は, が, の, を) before complex patterns
  2. FREQUENCY MATTERS: Common patterns before rare ones
  3. BUILDING BLOCKS: Simpler forms before compound/derived forms
  4. CONCEPTUAL CLUSTERS: Group related concepts (e.g., all tense markers together)
  5. SPIRAL LEARNING: Revisit concepts with increasing complexity

  PREREQUISITE RULES:
  - Prerequisites MUST be lesson IDs that appear EARLIER in the curriculum
  - A lesson in unit_03 cannot have prerequisites from unit_04
  - Limit prerequisites to 0-3 per lesson (avoid dependency chains)
  - First lessons in each unit should have minimal prerequisites

  STRICT OUTPUT RULES:
  - Output ONLY valid JSON, no markdown, no explanatory text
  - Use ONLY lesson IDs from the provided list
  - Every lesson ID must appear in EXACTLY ONE unit
  - Unit IDs: unit_01, unit_02, ... unit_NN (zero-padded)
  - Unit titles: max 6 words, descriptive

  OUTPUT SCHEMA:
  {
    "curriculum_id": "trial_N",
    "design_philosophy": "One sentence describing your organizing principle",
    "units": [
      {
        "id": "unit_01",
        "title": "Short Descriptive Title",
        "theme": "What unifies lessons in this unit",
        "lessons": ["lesson_id_1", "lesson_id_2", ...]
      }
    ],
    "prerequisites": {
      "lesson_id": ["prereq_lesson_id_1", "prereq_lesson_id_2"]
    }
  }

user_template: |
  Design a curriculum organization for these {num_lessons} lessons.

  TRIAL NUMBER: {trial_number} (use as curriculum_id: "trial_{trial_number}")

  AVAILABLE LESSONS (organize ALL of these):
  {lessons_json}

  Each lesson entry shows:
  - id: the lesson identifier (use exactly as-is)
  - grammar_point: what this lesson teaches
  - category: particle, auxiliary, conjugation, etc.
  - frequency: how often this appears in the corpus
  - difficulty_tier: 1=easiest to 5=hardest

  GRAMMAR INDEX (for understanding relationships):
  {grammar_summary}

  Output your curriculum as JSON only.

validation:
  required_fields:
    - curriculum_id
    - design_philosophy
    - units
    - prerequisites
  unit_required_fields:
    - id
    - title
    - theme
    - lessons
